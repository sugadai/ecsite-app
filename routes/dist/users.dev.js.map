{"version":3,"sources":["users.js"],"names":["con","require","express","session","app","router","Router","get","req","res","render","post","console","log","body","username","password","query","error","result","length","userid","id","email","redirect","insertId","destroy","err","module","exports"],"mappings":"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","sourcesContent":["const con = require('../db/dbconnect')\nconst express = require('express');\nconst session = require('express-session');\nconst app = express();\nconst router = express.Router();\n\n//toppage rendering\nrouter.get('/toppage',(req,res)=>{    \n    res.render('index.ejs')\n})\n// //Render to SignIn page\nrouter.get('/api1/signin',(req,res)=>{\n    res.render('signin.ejs')\n})\n\n// //Render SignUp page\nrouter.get('/api1/signup',(req,res)=>{\n    res.render('signup.ejs')\n})\n\nrouter.post('/api2/signin',(req,res) =>{\n    console.log(req.body)\n    const username = req.body.username;\n    const password = req.body.password;\n    con.query(\n        'SELECT * FROM USERS WHERE username=? AND password=?;'\n        ,[username,password],\n        (error,result)=>{\n            if(error) throw error;\n            console.log(result[0])\n            if(result.length){\n                req.session.userid= result[0].id;\n                console.log('ログイン成功ユーザーID： '+req.session.userid);\n                req.session.username = result[[0]].username;\n                req.session.email = result[0].email;\n                console.log(req.session.username)\n                // res.render('userpage.ejs',{username: result[0].username});\n                res.redirect(`/userpage`)\n            }\n        }\n    )\n})\n\nrouter.get('/userpage/',(req,res)=>{\n    res.render('userpage')\n})\n\n\n\nrouter.post('/api2/signup',(req,res) =>{\n    \n    const username = req.body.username;\n    const email = req.body.email;\n    const password = req.body.password;\n    // console.log(username,email,password)\n    con.query(\n        'INSERT INTO USERS (username,email,password) value(?,?,?);'\n        ,[username,email,password],\n        (error,result)=>{\n            console.log(result.insertId)\n            req.session.userid = result.insertId;\n            req.session.username = username\n            req.session.email = email;\n            console.log('会員登録されたユーザID：'+result.insertId)\n            if(error) throw error;\n            res.redirect(`/userpage`)\n        }\n    )\n});\n\nrouter.post('/logout',(req,res)=>{\n    console.log(req.session.userid)\n    req.session.destroy((err)=>{\n        if(err) throw err\n    });\n    \n    console.log('ログアウト完了')\n    res.redirect('/toppage');\n})\n\nmodule.exports = router;\n\n"],"file":"users.dev.js"}