{"version":3,"sources":["users.js"],"names":["con","require","express","app","Router","router","get","req","res","render","console","log","body","post","username","password","query","error","result","length","session","userid","id","email","redirect","insertId","destroy","err","module","exports"],"mappings":"aAAA,IAAMA,IAAMC,QAAQ,mBACdC,QAAUD,QAAQ,WADlBD,QAAMC,QAAQ,mBAGdE,IAAMD,UAFNA,OAAUD,QAAQG,SAMxBC,OAAOC,IAAI,WAAW,SAACC,EAAIC,GAJrBL,EAAGM,OAAGP,eAIZG,OAAOC,IAAI,eAAW,SAAAC,EAAAC,GAClBA,EAAIC,OAAO,gBAIXD,OAAIC,IAAAA,eAAJ,SAAAF,EAAAC,GAGJA,EAAAC,OAAA,gBAEID,OAAIC,KAAJ,eAAA,SAAAF,EAAAC,GADJE,QAAAC,IAAAJ,EAAAK,MAIAP,IAAOQ,EAAKN,EAAAK,KAAeE,SACfH,EAAQC,EAAhBA,KAAAG,SACAf,IAAMc,MACAC,uDACFC,CAAAA,EACAD,GAGOE,SAAAA,EAAOC,GACFP,GAARM,EAAkB,MAAlBA,EAAAP,QAAQC,IAAIO,EAAO,IACTC,EAAVA,SACQC,EAAQC,QAAQH,OAAAA,EAApB,GAAAI,GACQX,QAAIA,IAAA,iBAAqBS,EAAQC,QAAzCA,QACID,EAAQN,QAAZA,SAA6BI,EAAMJ,CAAAA,IAAnCA,SACIM,EAAQG,QAAQL,MAAUK,EAA9B,GAAAA,MACQZ,QAAQS,IAAAA,EAAQN,QALXA,UAOTU,EAAJA,SAAIA,kBAQnBnB,OAFDC,IAAA,aAAA,SAAAC,EAAAC,GAMAH,EAAOQ,OAAK,cAMRb,OAAIgB,KACA,eAAA,SAAAT,EAAAC,GAIID,IAAIa,EAAQC,EAASH,KAAAA,SACjBE,EAAQN,EAAAA,KAAWA,MACnBM,EAAJb,EAAoBgB,KAApBR,SAEAf,IAAGiB,MACCO,4DAVZ,CAAAV,EAAAS,EAAAR,GANJ,SAAAE,EAAAC,GA2BYP,GANAD,QAAAC,IAAUO,EAAAO,UACVd,EAAIJ,QAAIa,OAAhBF,EAAAO,SACIL,EAAQM,QAAQZ,SAAAA,EAChBP,EAAQa,QAAAG,MAAAA,EADZb,QAAAC,IAAA,gBAAAO,EAAAO,UAIYR,EAAA,MAAZA,EACIO,EAASA,SAATA,iBAPRnB,OAAOQ,KAAK,UAAU,SAACN,EAAIC,GACvBE,QAAQC,IAAIJ,EAAIa,QAAQC,QACxBd,EAAIa,QAAQM,QAAQ,SAACC,GACjB,GAAGA,EAAK,MAAMA,IAGlBjB,QAAQC,IAAI,WACZH,EAAIgB,SAAS,cAGjBI,OAAOC,QAAUxB","file":"users.min.js","sourcesContent":["const con = require('../db/dbconnect')\nconst express = require('express');\nconst session = require('express-session');\nconst app = express();\nconst router = express.Router();\n\n//toppage rendering\nrouter.get('/toppage',(req,res)=>{    \n    res.render('index.ejs')\n})\n// //Render to SignIn page\nrouter.get('/api1/signin',(req,res)=>{\n    res.render('signin.ejs')\n})\n\n// //Render SignUp page\nrouter.get('/api1/signup',(req,res)=>{\n    res.render('signup.ejs')\n})\n\nrouter.post('/api2/signin',(req,res) =>{\n    console.log(req.body)\n    const username = req.body.username;\n    const password = req.body.password;\n    con.query(\n        'SELECT * FROM USERS WHERE username=? AND password=?;'\n        ,[username,password],\n        (error,result)=>{\n            if(error) throw error;\n            console.log(result[0])\n            if(result.length){\n                req.session.userid= result[0].id;\n                console.log('ログイン成功ユーザーID： '+req.session.userid);\n                req.session.username = result[[0]].username;\n                req.session.email = result[0].email;\n                console.log(req.session.username)\n                // res.render('userpage.ejs',{username: result[0].username});\n                res.redirect(`/userpage`)\n            }\n        }\n    )\n})\n\nrouter.get('/userpage/',(req,res)=>{\n    res.render('userpage')\n})\n\n\n\nrouter.post('/api2/signup',(req,res) =>{\n    \n    const username = req.body.username;\n    const email = req.body.email;\n    const password = req.body.password;\n    // console.log(username,email,password)\n    con.query(\n        'INSERT INTO USERS (username,email,password) value(?,?,?);'\n        ,[username,email,password],\n        (error,result)=>{\n            console.log(result.insertId)\n            req.session.userid = result.insertId;\n            req.session.username = username\n            req.session.email = email;\n            console.log('会員登録されたユーザID：'+result.insertId)\n            if(error) throw error;\n            res.redirect(`/userpage`)\n        }\n    )\n});\n\nrouter.post('/logout',(req,res)=>{\n    console.log(req.session.userid)\n    req.session.destroy((err)=>{\n        if(err) throw err\n    });\n    \n    console.log('ログアウト完了')\n    res.redirect('/toppage');\n})\n\nmodule.exports = router;\n\n"]}