"use strict";var _require=require("express"),query=_require.query,con=require("../db/dbconnect"),search=function(e,s){s.send("puroduct search")},SignIn=function(o,r){var e=o.body.username,s=o.body.password,n={usernameErrMsg:"",passwordErrMsg:""};""==e&&(n.usernameErrMsg="ユーザ名を入力してください"),""==s&&(n.passwordErrMsg="パスワードを入力してください"),console.log(n),con.query("SELECT * FROM USERS WHERE username=? AND password=?;",[e,s],function(e,s){if(e)throw e;console.log(s[0]),s.length?(o.session.userid=s[0].id,console.log("ログイン成功ユーザーID： "+o.session.userid),o.session.username=s[0].username,o.session.email=s[0].email,1===o.session.userid?r.redirect("/api/v1/adminpage"):r.redirect("/api/v1/userpage")):(console.log("認証に失敗しました"),r.redirect("/api/v1/signin"))})},SignUp=function(o,r){var n=o.body.username,i=o.body.email,e=o.body.password;con.query("INSERT INTO USERS (username,email,password) value(?,?,?);",[n,i,e],function(e,s){if(console.log(s.insertId),o.session.userid=s.insertId,o.session.username=n,o.session.email=i,console.log("会員登録されたユーザID："+s.insertId),e)throw e;r.redirect("/api/v1/userpage")})},SignOut=function(e,s){console.log("a"),e.session.destroy(function(e){if(e)throw e}),console.log("ログアウト完了"),s.redirect("/api/v1")},password=function(e,o){var s=e.body.new_password,r=e.session.userid;con.query("UPDATE users SET password = ? WHERE id = ?;",[s,r],function(e,s){if(e)throw e;console.log("パスワード変更完了　ユーザID："+r),o.redirect("/api/v1/userpage")})},addProduct=function(o,r){var e=o.body.productname,s=o.body.price,n=o.body.imgpath,i=o.body.category_id;con.query("INSERT INTO product(productname,price,imgpath,category_id) value(?,?,?,?);",[e,s,n,i],function(e,s){if(e)throw e;console.log("商品追加完了"),o.session.addProduct=o.body,console.log(o.session.addProduct),r.redirect("/api/v1/addProductConfirm")})};module.exports={SignIn:SignIn,SignUp:SignUp,SignOut:SignOut,password:password,search:search,addProduct:addProduct};
//# sourceMappingURL=task.min.js.map
