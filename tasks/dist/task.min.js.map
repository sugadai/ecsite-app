{"version":3,"sources":["task.js"],"names":["require","query","con","search","req","res","send","SignIn","username","body","password","errMsg","passwordErrMsg","usernameErrMsg","console","error","log","result","length","session","userid","id","email","redirect","SignUp","insertId","SignOut","destroy","err","new_password","exports","module"],"mappings":"0BAAkBA,QAAQ,WAAlBC,eAAAA,MACFC,IAAMF,QAAQ,mBAGdG,OAAS,SAACC,EAAIC,GAHdH,EAAGI,KAAGN,oBAQZO,OAAA,SAAAH,EAAAC,GAGI,IAAMG,EAAWJ,EAAIK,KAAKD,SAFlBE,EAAGN,EAATG,KAAUH,SAENI,EAAWJ,CACXM,eAAW,GAEXC,eAAS,IAEG,IAAdC,IAFJD,EAAAE,eAAA,iBAIe,IAAZL,IACCG,EAAOE,eAAiB,kBAE5BC,QAAGJ,IAAQC,GACPA,IAAAA,MACH,uDAKI,CAACH,EAASE,GAHfI,SAAOC,EAAKJ,GAER,GAAAI,EAAA,MAAAA,EAGOA,QAAOC,IAAMD,EAAN,IACVE,EAAkBC,QAEdd,EAAIe,QAAQC,OAASH,EAAO,GAAGI,GADzBH,QAAOF,IAAA,iBAAAZ,EAAAe,QAAAC,QACTD,EAAQC,QAASH,SAArBA,EAAA,GAAAT,SACQQ,EAAIG,QAAAG,MAAAL,EAAqBE,GAAAA,MAIjCd,EAAAkB,SAAA,sBACIA,QAAJP,IAAA,aACCX,EAAAkB,SAAA,sBASXC,OAAS,SAACpB,EAAIC,GAEhB,IAAMG,EAAeC,EAAJA,KAASD,SACpBc,EAAYb,EAAJA,KAASa,MACjBZ,EAAeD,EAAJA,KAASC,SAE1BR,IAAID,MAIIa,4DACIK,CAAAA,EAAQC,EAASH,GACjBE,SAAAA,EAAJF,GAZZ,GAagBE,QAAQG,IAAQA,EAApBG,UACQT,EAAIG,QAAAC,OAAAH,EAAsBQ,SAC/BV,EAAOI,QAAMJ,SAANP,EACNe,EAAJJ,QAAAG,MAAAA,EAVRR,QAAAE,IAAA,gBAAAC,EAAAQ,UANJV,EAAA,MAAAA,EAgBYV,EAAIkB,SAAJ,uBAORG,QAAA,SAAAtB,EAAAC,GAIAS,QAAQE,IAAI,KACZX,EAAIkB,QAASI,QAAb,SAAAC,GAPJ,GAAAA,EAAA,MAAAA,IAWId,QAAMe,IAAAA,WACNxB,EAAMe,SAAShB,YAGXH,SACA,SAAAG,EAAAC,GAGI,IAAGuB,EAAKxB,EAAAK,KAAAoB,aACRf,EAAYV,EAAAe,QAAAC,OAVxBlB,IAAAD,MAMQ,8CASD6B,CAAAA,EAAUV,GAAO,SAAAQ,EAANrB,GAAOiB,GAAAA,EAAR,MAAAI,EAAeF,QAAfV,IAAA,mBAAAI,GAAuBV,EAAAA,SAAAA,uBAMxCqB,OAAAD,QAAA,CAAAvB,OAAAA,OAAAiB,OAAAA,OAAAE,QAAAA,QAAAhB,SAAAA,SAAAP,OAAAA","file":"task.min.js","sourcesContent":["const { query } = require('express');\nconst con = require('../db/dbconnect')\n\n//商品検索\nconst search = (req,res) => {\n    res.send('puroduct search')\n}\n\n\n//ログイン\nconst SignIn = (req,res) =>{\n    // console.log(req.body)\n    const username = req.body.username;\n    const password = req.body.password;\n\n    const errMsg = {\n        usernameErrMsg : '',\n        passwordErrMsg : ''\n    }\n    if(username == '' ){\n        errMsg.usernameErrMsg = 'ユーザ名を入力してください';\n    }\n    if(password == ''){\n        errMsg.passwordErrMsg = 'パスワードを入力してください';\n    }\n    \n    console.log(errMsg)\n    con.query(\n        'SELECT * FROM USERS WHERE username=? AND password=?;'\n        ,[username,password],\n        (error,result)=>{\n            if(error) throw error;\n            console.log(result[0])\n            if(result.length){\n                req.session.userid = result[0].id;\n                console.log('ログイン成功ユーザーID： '+req.session.userid);\n                req.session.username = result[0].username;\n                req.session.email = result[0].email;\n                // console.log(req.session.username)\n                // res.render('userpage.ejs',{username: result[0].username});\n                res.redirect(`/api/v1/userpage`);\n            }else{\n                console.log('認証に失敗しました')\n                res.redirect('/api/v1/signin')\n            }\n        }\n    )\n}\n\n//会員登録\nconst SignUp = (req,res) =>{\n    \n    const username = req.body.username;\n    const email = req.body.email;\n    const password = req.body.password;\n    // console.log(username,email,password)\n    con.query(\n        'INSERT INTO USERS (username,email,password) value(?,?,?);'\n        ,[username,email,password],\n        (error,result)=>{\n            console.log(result.insertId)\n            req.session.userid = result.insertId;\n            req.session.username = username\n            req.session.email = email;\n            console.log('会員登録されたユーザID：'+result.insertId)\n            if(error) throw error;\n            res.redirect(`/api/v1/userpage`)\n        }\n    )\n}\n\nconst SignOut = (req,res)=>{\n    console.log('a')\n    req.session.destroy((err)=>{\n        if(err) throw err\n    });\n    \n    console.log('ログアウト完了')\n    res.redirect('/api/v1');\n}\n\nconst password = (req,res) => {\n    const new_password = req.body.new_password\n    const userid = req.session.userid;\n    // console.log(new_password + ' ' + req.session.userid);\n    // sql = 'UPDATE users SET password = ? WHERE id = ?;';\n    con.query(\n        'UPDATE users SET password = ? WHERE id = ?;',\n        [new_password,userid],\n        (err,result)=>{\n            if(err) throw err\n            console.log('パスワード変更完了　ユーザID：' + userid);\n            res.redirect(`/api/v1/userpage`)\n        })\n}\n\nmodule.exports = {SignIn,SignUp,SignOut,password,search}\n\n\n\n// const search = async (req,res) =>{\n//     console.log(req.query.puroduct);\n//     const client_id = `dj00aiZpPUhPVW9ISXpNN3Q0RSZzPWNvbnN1bWVyc2VjcmV0Jng9Mjc-`;\n//     // const query = req.query.puroduct;\n//     // const url = `https://shopping.yahooapis.jp/ShoppingWebService/V2/itemSearch?appid=${client_id}>query=${query}`;\n//     const params = {\n//         response_type : 'code',\n//         client_id : client_id,\n//         redirect_uri : `https://www.yahoo.co.jp/`,\n//         scope : 'email'\n//     }\n    \n//     const query = new URLSearchParams(params);\n\n//     const url = `https://auth.login.yahoo.co.jp/yconnect/v2/authorization?response_type=code&client_id=${client_id}&redirect_uri=https://www.yahoo.co.jp/&scope=openid`\n//     console.log(url)\n\n//     try {\n//         const resdata =  await fetch(url)\n//         console.log(resdata)\n//         const data = await resdata.json();\n//         console.log(data);\n//         res.send(resdata);\n//     } catch (error) {\n//         res.send(error.status)\n//     }\n// }"]}